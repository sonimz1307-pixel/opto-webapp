<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 18px;
      background: #020617;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #e5e7eb;
    }

    h1 {
      margin: 0 0 18px;
      font-size: 22px;
      font-weight: 600;
    }

    h2 {
      font-size: 18px;
      margin: 32px 0 16px;
      font-weight: 600;
      color: #e2e8f0;
    }

    .field {
      margin-bottom: 22px;
      display: flex;
      flex-direction: column;
    }

    .field label {
      font-size: 15px;
      margin-bottom: 6px;
      color: #cbd5e1;
    }

    .field input {
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #334155;
      background: #0f172a;
      color: #f1f5f9;
      font-size: 15px;
    }

    .hint {
      margin-top: 6px;
      font-size: 13px;
      line-height: 1.45;
      color: #94a3b8;
    }

    .toggle-wrap {
      margin: 12px 0 26px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toggle-wrap span { font-size: 15px; }

    .button-primary,
    .button-secondary {
      width: 100%;
      display: block;
      padding: 16px;
      text-align: center;
      font-size: 16px;
      border-radius: 12px;
      margin-top: 16px;
      user-select: none;
      cursor: pointer;
    }

    .button-primary {
      font-weight: 600;
      background: #4f46e5;
      color: #fff;
      border: none;
    }

    .button-secondary {
      background: #1e293b;
      color: #e2e8f0;
      border: 1px solid #334155;
    }

    .button-disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
  </style>

</head>
<body>

  <h1>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</h1>

  <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
  <div class="field">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
    <input id="name" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏">
  </div>

  <!-- –ì–æ—Ä–æ–¥ -->
  <div class="field">
    <label>–ì–æ—Ä–æ–¥</label>
    <input id="city" type="text" placeholder="–ú–æ—Å–∫–≤–∞">
  </div>

  <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
  <div class="field">
    <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω</label>
    <input id="phone" type="text" placeholder="+7 999 000-00-00">
  </div>

  <!-- Telegram -->
  <div class="field">
    <label>Telegram</label>
    <input id="telegram" type="text" placeholder="@manager_opt">
  </div>

  <!-- –°–∞–π—Ç -->
  <div class="field">
    <label>–°–∞–π—Ç / —Å—Å—ã–ª–∫–∞</label>
    <input id="site" type="text" placeholder="https://example.com">
  </div>

  <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∞–π—Å -->
  <div class="field">
    <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç</label>
    <input id="price_link" type="text" placeholder="https://example.com/price.xlsx">

    <div class="hint">
      –ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç —Å—Ç–∞—Ç–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ ‚Äî –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –ø—Ä–∞–π—Å —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞.<br>
      –ï—Å–ª–∏ –∏–º–µ–µ—Ç—Å—è API –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç –ø—Ä–∞–π—Å–∞, –Ω–∞—à–∞ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.
    </div>
  </div>

  <!-- –°—Ç–∞—Ç—É—Å -->
  <div class="toggle-wrap">
    <input type="checkbox" id="active" style="transform: scale(1.3);" checked>
    <span>–ì–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–∫–∞–∑—ã</span>
  </div>

  <!-- üî∑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ -->
  <h2>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h2>

  <!-- –ü–æ–¥–∫–ª—é—á–∏—Ç—å –ú–æ–π–°–∫–ª–∞–¥ -->
  <button id="connect_moysklad_btn" class="button-secondary" style="border-color:#475569;color:#f1f5f9;">
    üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –ú–æ–π–°–∫–ª–∞–¥
  </button>

  <!-- 1–° -->
  <div class="button-secondary button-disabled">
    üì¶ –ü–æ–¥–∫–ª—é—á–∏—Ç—å 1–° (—Å–∫–æ—Ä–æ)
  </div>

  <!-- B2B -->
  <div class="button-secondary button-disabled">
    üõí –ü–æ–¥–∫–ª—é—á–∏—Ç—å B2B –∫–∞–±–∏–Ω–µ—Ç (—Å–∫–æ—Ä–æ)
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
  <div class="button-secondary" id="support_btn">‚úâÔ∏è –°–≤—è–∑–∞—Ç—å—Å—è —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</div>

  <!-- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å -->
  <div class="button-primary" id="save_btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</div>

  <script>
    const tg = window.Telegram.WebApp;

    // –í–∞–∂–Ω–æ! Telegram Desktop –Ω–µ –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–ª–∏–∫–∏, –ø–æ–∫–∞ WebApp –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
    tg.ready();
    tg.expand();
    tg.MainButton.hide();

    // ==== –ü–†–ò–Å–ú –ü–†–ï–î–ó–ê–ì–†–£–ñ–ï–ù–ù–´–• –î–ê–ù–ù–´–• ====
    const urlParams = new URLSearchParams(window.location.search);
    let incoming = null;

    try {
      if (urlParams.has("data")) {
        incoming = JSON.parse(urlParams.get("data"));
      }
    } catch (e) {
      console.error("–û—à–∏–±–∫–∞ JSON:", e);
    }

    if (incoming) {
      document.getElementById("name").value = incoming.name || "";
      document.getElementById("city").value = incoming.city || "";
      document.getElementById("phone").value = incoming.phone || "";
      document.getElementById("telegram").value = incoming.telegram || "";
      document.getElementById("site").value = incoming.site || "";
      document.getElementById("price_link").value = incoming.price_link || "";
      document.getElementById("active").checked = incoming.active !== false;
    }

    // --- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ú–æ–π–°–∫–ª–∞–¥ ---
    const connectBtn = document.getElementById("connect_moysklad_btn");
    connectBtn.setAttribute("role", "button");
    connectBtn.style.cursor = "pointer";

    connectBtn.addEventListener("click", () => {
      const data = { action: "connect_moysklad" };
      tg.sendData(JSON.stringify(data));
    });

    // --- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ---
    document.getElementById("support_btn").onclick = function () {
      window.open("https://t.me/Polite009", "_blank");
    };

    // --- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ---
    document.getElementById("save_btn").onclick = function () {
      const data = {
        action: "save_supplier_profile",
        name: document.getElementById("name").value.trim(),
        city: document.getElementById("city").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        telegram: document.getElementById("telegram").value.trim(),
        site: document.getElementById("site").value.trim(),
        price_link: document.getElementById("price_link").value.trim(),
        active: document.getElementById("active").checked
      };

      tg.sendData(JSON.stringify(data));
      setTimeout(() => tg.close(), 80);
    };
  </script>

</body>
</html>
